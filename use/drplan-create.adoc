---
sidebar: sidebar 
permalink: use/drplan-create.html 
keywords: disaster recovery, bluexp disaster recovery, failover, failback, replicate, fail over, fail back, vmware, vcenter, replication plan, protection, disaster, recovery, virtual machines, vm 
summary: NetApp BlueXP 災難恢復是一種雲端型災難恢復服務、可自動化災難恢復工作流程。新增 vCenter 站台之後、您就可以準備好建立災難恢復或複寫計畫。 
---
= 在 BlueXP 災難復原中建立複製計劃
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
新增 vCenter 站台之後、您就可以準備好建立災難恢復或複寫計畫。選取來源和目的地 vCenter 、挑選資源群組、然後群組應用程式的還原和開機方式。例如、您可以將與某個應用程式相關的虛擬機器（ VM ）分組、或是將具有類似階層的應用程式分組。

這類計畫有時稱為 _BluePrints_ 。

您可以建立複寫計畫、也可以編輯法規遵循與測試的排程。

您可以保護多個資料存放區上的多個 VM 。BlueXP  災難恢復會為所有託管受保護 VM 資料存放區的 ONTAP 磁碟區建立 ONTAP 一致性群組。

只有當複寫計畫處於下列其中一種狀態時，才能保護 VM ：

* 準備好
* 已認可容錯回復
* 測試已認可的容錯移轉




== 建立計畫

精靈會引導您完成下列步驟：

* 選取 vCenter 伺服器。
* 選取您要複寫並指派資源群組的 VM 或資料存放區。
* 對應來源環境中的資源如何對應到目的地。
* 識別週期、執行來賓主控指令碼、設定開機順序、然後選取還原點目標。
* 檢閱計畫。


建立計畫時、您應遵循以下準則：

* 對計畫中的所有 VM 使用相同的認證。
* 為計畫中的所有 VM 使用相同的指令碼。
* 規劃中的所有 VM 都使用相同的子網路、 DNS 和閘道。


.開始之前
如果您想在此服務中建立 SnapMirror 關係、則叢集及其 SVM 對等關係應已在 BlueXP 災難恢復之外設定。



=== 選取 vCenter 伺服器

首先、您選取來源 vCenter 、然後選取目的地 vCenter 。

.步驟
. 從 BlueXP 左側導航中，選擇 * 保護 * > * 災難恢復 * 。
. 從 BlueXP  災難恢復主菜單中，選擇 *Replication Plans （複製計劃） * 並選擇 *Add* （添加 * ）。或者、如果您剛開始使用該服務、請從儀表板選取 * 新增複寫計畫 * 。
+
image:dr-plan-create-name.png["顯示新增複寫計畫 > 新增計畫頁面的螢幕擷取畫面"]

. 建立複寫計畫的名稱。
. 從來源 vCenter 和目標 vCenter 清單中選取來源 vCenter 和目標 vCenter 。
. 選擇*下一步*。




=== 選取要複寫及指派資源群組的應用程式

下一步是將必要的 VM 或資料存放區分組到功能性資源群組中。資源群組可讓您使用通用快照來保護一組 VM 或資料存放區。

在複寫計畫中選取應用程式時，您可以在計畫中看到每個 VM 或資料存放區的作業系統。這有助於決定如何將資源群組中的虛擬機器或資料存放區分組。


TIP: 每個資源群組可以包含一或多個 VM 或資料存放區。

建立資源群組時，請考慮下列問題：

* 在將資料存放區新增至資源群組之前，請先開始手動探索或排程探索 VM 。如此可確保探索虛擬機器，並將其列在資源群組中。如果您未觸發手動探索，則虛擬機器可能不會列在資源群組中。
* 確保資料存放區中至少有一個 VM 。如果資料存放區中沒有 VM ，則不會探索資料存放區。
* 單一資料存放區不應裝載受多個複寫計畫保護的 VM 。
* 請勿在同一個資料存放區上裝載受保護和未受保護的 VM 。如果受保護和未受保護的 VM 託管在同一個資料存放區上，可能會發生下列問題：
+
** 由於 BlueXP  災難恢復使用 SnapMirror ，系統會複寫整個 ONTAP 磁碟區，因此該磁碟區的使用容量會用於授權考量。在這種情況下，受保護和未受保護的虛擬機器所消耗的磁碟區空間會納入此計算。
** 如果資源群組及其相關的資料存放區需要容錯移轉至災難恢復站台，則來源站台上不再存在任何未受保護的 VM （ VM 不屬於資源群組的一部分，而是裝載於 ONTAP Volume 上），因為容錯移轉程序而導致來源站台上未受保護的 VM 故障。此外， BlueXP  災難恢復也不會在容錯移轉 vCenter 站台啟動那些未受保護的 VM 。


* 若要保護 VM ，必須將其包含在資源群組中。


* 最佳實務做法 * ：在部署 BlueXP  災難恢復之前，先組織好您的虛擬機器，以將「資料存放區過度擴張」降至最低。將需要保護的虛擬機器放在資料存放區子集上，並將不受保護的虛擬機器放在不同的資料存放區子集上。使用資料存放區型保護，確保任何指定資料存放區上的虛擬機器受到保護。

.步驟
. 選取 * 虛擬機器 * 或 * 資料存放區 * 。
. 您也可以依名稱搜尋特定的 VM 或資料存放區。
. 在「應用程式」頁面左側，選取您要保護的虛擬機器或資料存放區，然後指派給選取的群組。
+
選取的資源會自動新增至群組 1 ，並啟動新的群組 2 。每次將資源新增至最後一個群組時，都會新增另一個群組。

+
image:dr-plan-create-apps-vms6.png["顯示「新增複寫計畫 > 要複寫的應用程式」頁面的螢幕擷取畫面"]

+
或者，對於資料存放區：

+
image:dr-plan-create-apps-datastores.png["顯示「新增複寫計畫 > 要複寫的應用程式」頁面的螢幕擷取畫面"]

. 您也可以選擇執行下列任一動作：
+
** 若要變更群組名稱、請按一下群組 * 編輯 * image:icon-pencil.png["鉛筆圖示"]圖示。
** 若要從群組中移除資源，請選取資源旁邊的 * X* 。
** 若要將資源移至其他群組，請將其拖放至新群組。
+

TIP: 若要將資料存放區移至不同的資源群組，請取消選取不需要的資料存放區，然後提交複寫計畫。然後，建立或編輯其他複寫計畫，並重新選取資料儲存設備。



. 選擇*下一步*。




=== 將來源資源對應至目標

在資源對應步驟中、指定來源環境中的資源應如何對應至目標。建立複寫計畫時、您可以為計畫中的每個 VM 設定開機延遲和順序。這可讓您設定虛擬機器啟動順序。

.開始之前
如果您想在此服務中建立 SnapMirror 關係、則叢集及其 SVM 對等關係應已在 BlueXP 災難恢復之外設定。

.步驟
. 在「資源對應」頁面中、若要對容錯移轉和測試作業使用相同的對應、請核取方塊。
+
image:dr-plan-resource-mapping2.png["複寫計畫、資源對應索引標籤"]

. 在容錯移轉對應索引標籤中、選取每個資源右側的向下箭頭、並對應每個資源中的資源。




=== 地圖資源 > 運算資源區段

選取 * 運算資源 * 旁的向下箭頭。

* * 來源與目標資料中心 *
* * 目標叢集 *
* * 目標主機 * （選用）：選取叢集之後、您就可以設定此資訊。



TIP: 如果 vCenter 已設定分散式資源排程器（ DRS ）來管理叢集中的多部主機、則不需要選取主機。如果您選取主機、 BlueXP  災難恢復會將所有虛擬機器放置在所選的主機上。* * 目標 VM 資料夾 * （選用）：建立新的根資料夾來儲存所選的 VM 。



=== 對應資源 > 虛擬網路區段

在 [ 容錯移轉對應 ] 索引標籤中，選取 [* 虛擬網路 * ] 旁邊的向下箭號。選取來源虛擬 LAN 和目標虛擬 LAN 。

選取對應至適當虛擬 LAN 的網路。應已配置虛擬 LAN ，因此請選擇適當的虛擬 LAN 來對應 VM 。



=== 對應資源 > 虛擬機器區段

在 [ 容錯移轉對應 ] 索引標籤中，選取 [* 虛擬機器 * ] 旁邊的向下箭號。

虛擬機器的預設值已對應。預設對應使用的設定與虛擬機器在正式作業環境中使用的設定相同（相同的 IP 位址，子網路遮罩和閘道）。

如果您對預設設定進行任何變更，則必須將目標 IP 欄位變更為「與來源不同」。


NOTE: 如果您將設定變更為「與來源不同」，則需要提供 VM 來賓作業系統認證。

根據您的選擇、此區段可能會顯示不同的欄位。

* * IP 位址類型 * ：重新設定 VM 組態、以符合目標虛擬網路需求。BlueXP  災難恢復提供兩種選項： DHCP 或靜態 IP 。對於靜態 IP 、請設定子網路遮罩、閘道和 DNS 伺服器。此外、請輸入 VM 的認證。
+
** *DHCP/* ：如果您希望 VM 從 DHCP 伺服器取得網路組態資訊、請選取此設定。如果您選擇此選項、則只會提供 VM 的認證。
** * 靜態 IP* ：如果您想手動指定 IP 組態資訊、請選取此設定。您可以選取下列其中一項：與來源相同，來源不同或子網路對應。如果您選擇的來源相同、則不需要輸入認證。另一方面、如果您選擇使用來源的不同資訊、則可以提供認證、 VM 的 IP 位址、子網路遮罩、 DNS 和閘道資訊。VM 來賓作業系統認證應提供給全域層級或每個 VM 層級。
+
這對於將大型環境恢復到較小的目標叢集或進行災難恢復測試而言非常有幫助、而無需配置一對一實體 VMware 基礎架構。

+
image:dr-plan-vm-subnet-option2.png["顯示新增複寫計畫 > 資源對應 > 虛擬機器的螢幕擷取畫面"]



* *目標 IP* 字段，選擇以下選項之一：
+
** *與來源相同*
** *與來源不同*
** *子網路對應*：如果要將來源子網路對應到不同的目標子網，請選擇此選項。您可以選擇來源子網，然後選擇目標子網路。當您想要變更目標環境中虛擬機器的 IP 位址時，此選項非常有用。
+

NOTE: 使用子網路映射是一個可選的兩步驟過程：首先，在「站點」標籤中為每個 vCenter 站點新增子網路映射。其次，在複寫計畫中，指出您要使用子網路對應。

+

NOTE: 如果有兩個 VM （例如，一個是 Linux ，另一個是 Windows ），則只有 Windows 需要認證。



* *使用 Windows LAPS*：如果您使用 Windows 本機管理員密碼解決方案 (Windows LAPS)，請勾選此方塊。此選項僅在您選擇“靜態 IP”選項時可用。勾選此方塊後，您無需為每個虛擬機器提供密碼，只需提供網域控制器詳細資訊即可。
+
如果您不使用 Windows LAPS，則該虛擬機為 Windows 虛擬機，且虛擬機器行上的憑證選項已啟用。您可以提供該虛擬機器的憑證。

* * 指令碼 * ：您可以在容錯移轉後的程序中加入 .sh 、 .bat 或 .ps1 格式的自訂指令碼。透過自訂指令碼、您可以在容錯移轉程序之後執行 BlueXP 災難恢復指令碼。例如、您可以使用自訂指令碼、在容錯移轉完成後恢復所有資料庫交易。
* * 目標 VM 前置詞和後置詞 * ：在虛擬機器詳細資料下、您可以選擇性地將前置詞和後置詞新增至 VM 名稱。
* * 來源 VM CPU 和 RAM* ：在虛擬機器詳細資料下、您可以選擇性地調整 VM CPU 和 RAM 參數的大小。
+
image:dr-plan-resource-mapping-vm-boot-order.png["顯示新增複寫計畫 > 資源對應 > 虛擬機器的螢幕擷取畫面"]

* * 開機順序 * ：您可以在跨資源群組的所有選定虛擬機器進行容錯移轉後、修改開機順序。依預設，所有 VM 都會平行開機；不過，您可以在此階段進行變更。這有助於確保在後續優先順序 VM 啟動之前、所有優先順序為一部 VM 都在執行中。
+
任何具有相同開機順序編號的 VM 都會平行開機。

+
** 循序開機：為每個 VM 指派唯一的編號，以指定的順序來開機，例如 1 ， 2 ， 3 ， 4 ， 5 。
** 同步開機：將相同的數目指派給任何 VM 以同時開機，例如 1 ， 1 ， 1 ， 2 ， 3 ， 4 ， 4 。


* * 開機延遲 * ：調整開機動作的延遲時間（以分鐘為單位）。
+

TIP: 若要將開機順序重設為預設值、請選取 * 將虛擬機器設定重設為預設值 * 、然後選擇要變更回預設值的設定。

* * 建立應用程式一致的複本 * ：指出是否要建立應用程式一致的快照複本。服務會先將應用程式設為「已」、然後再建立快照、以取得應用程式的一致狀態。在 Windows 和 Linux 上執行的 Oracle 、以及在 Windows 上執行的 SQL Server 、都支援此功能。




=== 對應資源 > 資料存放區區區區段

選取 * 資料存放區 * 旁的向下箭頭。根據VM的選擇、會自動選取資料存放區對應。

視您的選擇而定、此區段可能會啟用或停用。

image:dr-plan-datastore-platform.png["顯示新增複寫計畫 > 資源對應 > 資料存放區的螢幕擷取畫面"]

* * 使用平台管理的備份與保留排程 * ：如果您使用的是外部快照管理解決方案，請勾選此方塊。BlueXP  災難恢復支援使用外部快照管理解決方案，例如原生 ONTAP SnapMirror 原則排程器或協力廠商整合。如果複寫計畫中的每個資料存放區（ Volume ）都已有 SnapMirror 關係，而該關係正在其他地方管理，您可以將這些快照作為 BlueXP  災難恢復的恢復點。
+
選取此選項時， BlueXP  災難恢復不會設定備份排程。不過，您仍需要設定保留排程，因為仍可能需要拍攝快照來執行測試，容錯移轉和容錯回復作業。

+
設定此選項之後，服務不會定期擷取任何排程的快照，而是仰賴外部實體來拍攝和更新這些快照。

* * 開始時間 * ：輸入開始執行備份與保留的日期與時間。
* * 執行時間間隔 * ：以小時和分鐘為單位輸入時間間隔。例如，如果您輸入 1 小時，服務會每小時拍攝一次快照。
* * 保留計數 * ：輸入您要保留的快照數。
* * 來源和目標資料存放區 * ：如果存在多個（扇出） SnapMirror 關係、您可以選取要使用的目的地。如果某個 Volume 已經建立 SnapMirror 關係、則會顯示對應的來源和目標資料存放區。如果磁碟區沒有 SnapMirror 關係，您現在可以選取目標叢集，選取目標 SVM ，並提供磁碟區名稱來建立。服務將建立 Volume 和 SnapMirror 關係。
+

NOTE: 如果您想在此服務中建立 SnapMirror 關係、則叢集及其 SVM 對等關係應已在 BlueXP 災難恢復之外設定。

+
** 如果 VM 來自同一個 Volume 和同一個 SVM 、則服務會執行標準 ONTAP 快照、並更新次要目的地。
** 如果 VM 來自不同的 Volume 和相同的 SVM 、則服務會加入所有的 Volume 並更新次要目的地、以建立一致性群組快照。
** 如果 VM 來自不同的 Volume 和不同的 SVM 、服務會執行一致性群組啟動階段和提交階段快照、方法是將所有磁碟區納入相同或不同的叢集中、並更新次要目的地。
** 在容錯移轉期間、您可以選取任何快照。如果您選取最新的快照，服務會建立隨需備份，更新目的地，並使用該快照進行容錯移轉。






=== 新增測試容錯移轉對應

.步驟
. 若要為測試環境設定不同的對應、請取消勾選方塊、然後選取 * 測試對應 * 標籤。
. 請像以前一樣瀏覽每個標籤、但這次是測試環境的標籤。
+
在測試對應索引標籤上、虛擬機器和資料存放區對應會停用。

+

TIP: 您可以稍後測試整個計畫。現在您正在設定測試環境的對應。





=== 檢閱複寫計畫

最後、請花點時間檢閱複寫計畫。


TIP: 您可以稍後停用或刪除複寫計畫。

.步驟
. 檢閱每個索引標籤中的資訊：規劃詳細資料、容錯移轉對應和 VM 。
. 選取 * 新增計畫 * 。
+
計畫即會新增至計畫清單。





== 編輯排程以測試法規遵循狀況、並確保容錯移轉測試正常運作

您可能會想要設定排程來測試法規遵循和容錯移轉測試、以便確保它們能在您需要時正常運作。

* * 法規遵循時間影響 * ：建立複寫計畫時、服務預設會建立法規遵循排程。預設的法規遵循時間為 30 分鐘。若要變更此時間、您可以使用複寫計畫中的編輯排程。
* * 測試容錯移轉影響 * ：您可以根據需求或排程來測試容錯移轉程序。這可讓您測試將虛擬機器容錯移轉至複寫計畫中指定的目的地。
+
測試容錯移轉會建立 FlexClone Volume 、裝載資料存放區、並在該資料存放區上移動工作負載。測試容錯移轉作業不會影響正式作業工作負載、測試站台上使用的 SnapMirror 關係、以及必須繼續正常運作的受保護工作負載。



根據排程、容錯移轉測試會執行、並確保工作負載移至複寫計畫指定的目的地。

.步驟
. 從 BlueXP 災難恢復主菜單中，選擇 *Replication Plans （複製計劃） * 。
+
image:dr-plan-list.png["顯示複寫計畫清單的螢幕擷取畫面"]

. 選取 * 動作 * image:icon-horizontal-dots.png["水平圓點動作功能表"] 圖示並選取 * 編輯排程 * 。
. 輸入您希望 BlueXP 災難恢復檢查測試法規遵循的頻率（以分鐘為單位）。
. 若要檢查容錯移轉測試是否正常、請核取 * 每月排程執行容錯移轉 * 。
+
.. 選取您要執行這些測試的月份和時間。
.. 當您想要開始測試時、請以 yyyy-mm-dd 格式輸入日期。
+
image:dr-plan-schedule-edit2.png["顯示您可以編輯排程的螢幕擷取畫面"]



. * 使用隨需快照進行排程測試容錯移轉 * ：若要在啟動自動測試容錯移轉之前先建立新的快照，請勾選此方塊。
. 若要在容錯移轉測試完成後清理測試環境，請核取 * 測試容錯移轉後自動清理 * ，然後輸入您要在清除開始前等待的分鐘數。
+

NOTE: 此程序會從測試位置取消暫存虛擬機器的登錄、刪除所建立的 FlexClone Volume 、並卸載暫存資料存放區。

. 選擇*保存*。

