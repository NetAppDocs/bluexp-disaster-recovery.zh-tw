---
sidebar: sidebar 
permalink: use/drplan-create.html 
keywords: disaster recovery, bluexp disaster recovery, failover, failback, replicate, fail over, fail back, vmware, vcenter, replication plan, protection, disaster, recovery, virtual machines, vm 
summary: NetApp BlueXP 災難恢復是一種雲端型災難恢復服務、可自動化災難恢復工作流程。新增 vCenter 站台之後、您就可以準備好建立災難恢復或複寫計畫。 
---
= 建立複寫計畫
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
新增 vCenter 站台之後、您就可以準備好建立災難恢復或複寫計畫。選取來源和目的地 vCenter 、挑選資源群組、然後群組應用程式的還原和開機方式。例如、您可以將與某個應用程式相關的虛擬機器（ VM ）分組、或是將具有類似階層的應用程式分組。

這類計畫有時稱為 _BluePrints_ 。

您可以建立複寫計畫、也可以編輯法規遵循與測試的排程。

您可以保護多個資料存放區上的多個 VM 。BlueXP  災難恢復會為所有託管受保護 VM 資料存放區的 ONTAP 磁碟區建立 ONTAP 一致性群組。



== 建立計畫

精靈會引導您完成下列步驟：

* 選取 vCenter 伺服器。
* 選取您要複寫的虛擬機器、然後指派群組。
* 對應來源環境中的資源如何對應到目的地。
* 識別週期、執行來賓主控指令碼、設定開機順序、然後選取還原點目標。
* 檢閱計畫。


建立計畫時、您應遵循以下準則：

* 對計畫中的所有 VM 使用相同的認證。
* 為計畫中的所有 VM 使用相同的指令碼。
* 規劃中的所有 VM 都使用相同的子網路、 DNS 和閘道。


.開始之前
如果您想在此服務中建立 SnapMirror 關係、則叢集及其 SVM 對等關係應已在 BlueXP 災難恢復之外設定。



=== 選取 vCenter 伺服器

首先、您選取來源 vCenter 、然後選取目的地 vCenter 。

.步驟
. 從 BlueXP 左側導航中，選擇 * 保護 * > * 災難恢復 * 。
. 從 BlueXP  災難恢復主菜單中，選擇 *Replication Plans （複製計劃） * 並選擇 *Add* （添加 * ）。或者、如果您剛開始使用該服務、請從儀表板選取 * 新增複寫計畫 * 。
+
image:dr-plan-create-name.png["顯示新增複寫計畫 > 新增計畫頁面的螢幕擷取畫面"]

. 建立複寫計畫的名稱。
. 從來源 vCenter 和目標 vCenter 清單中選取來源 vCenter 和目標 vCenter 。
. 選擇*下一步*。




=== 選取要複寫及指派資源群組的應用程式

下一步是將所需的虛擬機器分組為功能性資源群組。資源群組可讓您將一組相關的 VM 分組為符合您需求的邏輯群組。例如、群組可能包含延遲開機順序、可在恢復時執行。

在複寫計畫中選取應用程式時、您可以在計畫中看到每個 VM 的作業系統。這有助於決定如何將 VM 群組在資源群組中。


TIP: 每個資源群組可以包含一或多個 VM 。虛擬機器將根據您在此加入的順序來啟動。

.步驟
. 或者、在「應用程式」頁面左側、依虛擬機器的資料存放區篩選虛擬機器。您也可以依名稱搜尋特定 VM 。
. 在「應用程式」頁面左側、選取您要保護的虛擬機器、然後指派給選取的群組。
+
選取的 VM 會自動新增至群組 1 、並啟動新的群組 2 。每次將 VM 新增至最後一個群組時、都會新增另一個群組。

+
image:dr-plan-create-apps-vms5.png["顯示「新增複寫計畫 > 要複寫的應用程式」頁面的螢幕擷取畫面"]

. 您也可以選擇執行下列任一動作：
+
** 若要變更群組名稱、請按一下群組 * 編輯 * image:icon-pencil.png["鉛筆圖示"]圖示。
** 若要從群組中移除 VM 、請選取 VM 旁的 * X* 。
** 若要將虛擬機器移至其他群組、請將其拖放至新群組。


. 當您有多個資源群組時、請確定群組的順序符合應該發生的操作順序。
+
群組中的每個 VM 都會根據此處的訂單依序啟動。

. 選擇*下一步*。




=== 將來源資源對應至目標

在資源對應步驟中、指定來源環境中的資源應如何對應至目標。建立複寫計畫時、您可以為計畫中的每個 VM 設定開機延遲和順序。這可讓您設定虛擬機器啟動順序。

.開始之前
如果您想在此服務中建立 SnapMirror 關係、則叢集及其 SVM 對等關係應已在 BlueXP 災難恢復之外設定。

.步驟
. 在「資源對應」頁面中、若要對容錯移轉和測試作業使用相同的對應、請核取方塊。
+
image:dr-plan-resource-mapping2.png["複寫計畫、資源對應索引標籤"]

. 在容錯移轉對應索引標籤中、選取每個資源右側的向下箭頭、並對應每個資源中的資源。
. * 運算資源 * ：選取 * 運算資源 * 旁的向下箭頭。
+
** * 來源與目標資料中心 *
** * 目標叢集 *
** * 目標主機 * （選用）：選取叢集之後、您就可以設定此資訊。
+

TIP: 如果 vCenter 已設定分散式資源排程器（ DRS ）來管理叢集中的多部主機、則不需要選取主機。如果您選取主機、 BlueXP  災難恢復會將所有虛擬機器放置在所選的主機上。

** * 目標 VM 資料夾 * （選用）：建立新的根資料夾來儲存所選的 VM 。


. * 虛擬網路 * ：在容錯移轉對應標籤中、選取 * 虛擬網路 * 旁的向下箭頭。選取來源虛擬 LAN 和目標虛擬 LAN 。
+
選取對應至適當虛擬 LAN 的網路。應已配置虛擬 LAN ，因此請選擇適當的虛擬 LAN 來對應 VM 。

. * 虛擬機器 * ：在容錯移轉對應標籤中、選取 * 虛擬機器 * 旁的向下箭頭。
+
虛擬機器的預設值已對應。預設對應使用的設定與虛擬機器在正式作業環境中使用的設定相同（相同的 IP 位址，子網路遮罩和閘道）。

+
如果您對預設設定進行任何變更，則必須將目標 IP 欄位變更為「與來源不同」。

+

NOTE: 如果您將設定變更為「與來源不同」，則需要提供 VM 來賓作業系統認證。

+
根據您的選擇、此區段可能會顯示不同的欄位。

+
** * IP 位址類型 * ：重新設定 VM 組態、以符合目標虛擬網路需求。BlueXP  災難恢復提供兩種選項： DHCP 或靜態 IP 。對於靜態 IP 、請設定子網路遮罩、閘道和 DNS 伺服器。此外、請輸入 VM 的認證。
+
*** *DHCP/* ：如果您希望 VM 從 DHCP 伺服器取得網路組態資訊、請選取此設定。如果您選擇此選項、則只會提供 VM 的認證。
*** * 靜態 IP* ：如果您想手動指定 IP 組態資訊、請選取此設定。您可以從來源 VM 選取相同或不同的資訊。如果您選擇的來源相同、則不需要輸入認證。另一方面、如果您選擇使用來源的不同資訊、則可以提供認證、 VM 的 IP 位址、子網路遮罩、 DNS 和閘道資訊。VM 來賓作業系統認證應提供給全域層級或每個 VM 層級。
+
這對於將大型環境恢復到較小的目標叢集或進行災難恢復測試而言非常有幫助、而無需配置一對一實體 VMware 基礎架構。

+
image:dr-plan-create-mapping-vms2.png["顯示新增複寫計畫 > 資源對應 > 虛擬機器的螢幕擷取畫面"]



** * 指令碼 * ：您可以在容錯移轉後的程序中加入 .sh 、 .bat 或 .ps1 格式的自訂指令碼。透過自訂指令碼、您可以在容錯移轉程序之後執行 BlueXP 災難恢復指令碼。例如、您可以使用自訂指令碼、在容錯移轉完成後恢復所有資料庫交易。
** * 目標 VM 前置詞和後置詞 * ：在虛擬機器詳細資料下、您可以選擇性地將前置詞和後置詞新增至 VM 名稱。
** * 來源 VM CPU 和 RAM* ：在虛擬機器詳細資料下、您可以選擇性地調整 VM CPU 和 RAM 參數的大小。
+
image:dr-plan-resource-mapping-vm-boot-order.png["顯示新增複寫計畫 > 資源對應 > 虛擬機器的螢幕擷取畫面"]

** * 開機順序 * ：您可以在跨資源群組的所有選定虛擬機器進行容錯移轉後、修改開機順序。根據預設、會使用在資源群組選擇期間選取的開機順序；不過、您可以在此階段進行變更。這有助於確保在後續優先順序 VM 啟動之前、所有優先順序為一部 VM 都在執行中。
+
開機順序編號僅適用於資源群組。如果您在一個群組中有「 2 」、在另一個群組中有「 2 」、則第一個群組中的虛擬機器會依其順序啟動、而第二個群組中的虛擬機器則會依其順序啟動。

+
*** 循序開機：為每個 VM 指派唯一的編號、以指定的順序開機、例如 1 、 2 、 3 、 4 、 5
*** 同步開機：將相同數目指派給所有 VM 、以便同時開機、例如 1 、 1 、 1 、 2 、 3 、 4 、 4 。


** * 開機延遲 * ：調整開機動作的延遲時間（以分鐘為單位）。
+

TIP: 若要將開機順序重設為預設值、請選取 * 將虛擬機器設定重設為預設值 * 、然後選擇要變更回預設值的設定。

** * 建立應用程式一致的複本 * ：指出是否要建立應用程式一致的快照複本。服務會先將應用程式設為「已」、然後再建立快照、以取得應用程式的一致狀態。在 Windows 和 Linux 上執行的 Oracle 、以及在 Windows 上執行的 SQL Server 、都支援此功能。


. * 資料存放區 * ：選取 * 資料存放區 * 旁的向下箭頭。根據VM的選擇、會自動選取資料存放區對應。
+
視您的選擇而定、此區段可能會啟用或停用。

+
** * RPO * ：輸入恢復點目標（ RPO ）以指示要恢復的資料量（以時間為單位）。例如、如果您輸入的 RPO 為 60 分鐘、則還原的資料一定不會超過 60 分鐘。如果發生災難、您最多可以損失 60 分鐘的資料。同時輸入所有資料存放區要保留的快照複本數量。
** * 保留計數 * ：輸入您要保留的快照數。
** * 來源和目標資料存放區 * ：如果存在多個（扇出） SnapMirror 關係、您可以選取要使用的目的地。如果某個 Volume 已經建立 SnapMirror 關係、則會顯示對應的來源和目標資料存放區。如果磁碟區沒有 SnapMirror 關係、您現在可以選取目標叢集、目標 SVM 並提供磁碟區名稱來建立一個。服務將建立 Volume 和 SnapMirror 關係。
+

NOTE: 如果您想在此服務中建立 SnapMirror 關係、則叢集及其 SVM 對等關係應已在 BlueXP 災難恢復之外設定。

** 當您指定恢復點目標（ RPO ）時、服務會根據 RPO 排程主要備份、並更新次要目的地。
** 如果 VM 來自同一個 Volume 和同一個 SVM 、則服務會執行標準 ONTAP 快照、並更新次要目的地。
** 如果 VM 來自不同的 Volume 和相同的 SVM 、則服務會加入所有的 Volume 並更新次要目的地、以建立一致性群組快照。
** 如果 VM 來自不同的 Volume 和不同的 SVM 、服務會執行一致性群組啟動階段和提交階段快照、方法是將所有磁碟區納入相同或不同的叢集中、並更新次要目的地。
** 在容錯移轉期間、您可以選取任何快照。如果您選取最新的快照，服務會建立隨需備份，更新目的地，並使用該快照進行容錯移轉。






=== 測試對應

.步驟
. 若要為測試環境設定不同的對應、請取消勾選方塊、然後選取 * 測試對應 * 標籤。
. 請像以前一樣瀏覽每個標籤、但這次是測試環境的標籤。
+
在測試對應索引標籤上、虛擬機器和資料存放區對應會停用。

+

TIP: 您可以稍後測試整個計畫。現在您正在設定測試環境的對應。





=== 識別週期

選擇是要將資料（一次性移動）移轉至另一個目標、還是要以 SnapMirror 頻率複寫資料。

如果您想複寫資料、請確定資料應多久鏡射一次。

.步驟
. 在 Recurence （循環）頁面中，選擇 *Migrate* 或 *Replicate* 。
+
** * 移轉 * ：選取以將應用程式移至目標位置。
** * Replicate * ：在週期性複寫中、將目標複本與來源複本的變更保持在最新狀態。


+
image:dr-plan-create-recurrence.png["顯示新增複寫計畫 > 週期性的螢幕擷取畫面"]

. 選擇*下一步*。




=== 檢閱複寫計畫

最後、請花點時間檢閱複寫計畫。


TIP: 您可以稍後停用或刪除複寫計畫。

.步驟
. 檢閱每個索引標籤中的資訊：規劃詳細資料、容錯移轉對應和 VM 。
. 選取 * 新增計畫 * 。
+
計畫即會新增至計畫清單。





== 編輯排程以測試法規遵循狀況、並確保容錯移轉測試正常運作

您可能會想要設定排程來測試法規遵循和容錯移轉測試、以便確保它們能在您需要時正常運作。

* * 法規遵循時間影響 * ：建立複寫計畫時、服務預設會建立法規遵循排程。預設的法規遵循時間為 30 分鐘。若要變更此時間、您可以使用複寫計畫中的編輯排程。
* * 測試容錯移轉影響 * ：您可以根據需求或排程來測試容錯移轉程序。這可讓您測試將虛擬機器容錯移轉至複寫計畫中指定的目的地。
+
測試容錯移轉會建立 FlexClone Volume 、裝載資料存放區、並在該資料存放區上移動工作負載。測試容錯移轉作業不會影響正式作業工作負載、測試站台上使用的 SnapMirror 關係、以及必須繼續正常運作的受保護工作負載。



根據排程、容錯移轉測試會執行、並確保工作負載移至複寫計畫指定的目的地。

.步驟
. 從 BlueXP 災難恢復主菜單中，選擇 *Replication Plans （複製計劃） * 。
+
image:dr-plan-list.png["顯示複寫計畫清單的螢幕擷取畫面"]

. 選取 * 動作 * image:icon-horizontal-dots.png["水平圓點動作功能表"] 圖示並選取 * 編輯排程 * 。
. 輸入您希望 BlueXP 災難恢復檢查測試法規遵循的頻率（以分鐘為單位）。
. 若要檢查容錯移轉測試是否正常、請核取 * 每月排程執行容錯移轉 * 。
+
.. 選取您要執行這些測試的月份和時間。
.. 當您想要開始測試時、請以 yyyy-mm-dd 格式輸入日期。
+
image:dr-plan-schedule-edit.png["顯示您可以編輯排程的螢幕擷取畫面"]



. 若要在容錯移轉測試完成後清理測試環境、請核取 * 測試容錯移轉後自動清理 * 。
+

NOTE: 此程序會從測試位置取消暫存虛擬機器的登錄、刪除所建立的 FlexClone Volume 、並卸載暫存資料存放區。

. 選擇*保存*。

